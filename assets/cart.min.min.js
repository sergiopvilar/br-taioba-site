var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};var CartRemoveButton=function(_super){__extends(CartRemoveButton,_super);function CartRemoveButton(){var _this=_super.call(this)||this;_this.addEventListener("click",function(event){event.preventDefault();var cartItems=_this.closest("cart-items")||_this.closest("cart-drawer-items");cartItems.updateQuantity(_this.dataset.index,0)});return _this}return CartRemoveButton}(HTMLElement);customElements.define("cart-remove-button",CartRemoveButton);var CartItems=function(_super){__extends(CartItems,_super);function CartItems(){var _this=_super.call(this)||this;_this.cartUpdateUnsubscriber=undefined;_this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");var debouncedOnChange=debounce(function(event){_this.onChange(event)},ON_CHANGE_DEBOUNCE_TIMER);_this.addEventListener("change",debouncedOnChange.bind(_this));return _this}CartItems.prototype.connectedCallback=function(){var _this=this;this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,function(event){if(event.source==="cart-items"){return}_this.onCartUpdate()})};CartItems.prototype.disconnectedCallback=function(){if(this.cartUpdateUnsubscriber){this.cartUpdateUnsubscriber()}};CartItems.prototype.onChange=function(event){this.updateQuantity(event.target.dataset.index,event.target.value,document.activeElement.getAttribute("name"),event.target.dataset.quantityVariantId)};CartItems.prototype.onCartUpdate=function(){var _this=this;if(this.tagName==="CART-DRAWER-ITEMS"){fetch("".concat(routes.cart_url,"?section_id=cart-drawer")).then(function(response){return response.text()}).then(function(responseText){var html=(new DOMParser).parseFromString(responseText,"text/html");var selectors=["cart-drawer-items",".cart-drawer__footer"];for(var _i=0,selectors_1=selectors;_i<selectors_1.length;_i++){var selector=selectors_1[_i];var targetElement=document.querySelector(selector);var sourceElement=html.querySelector(selector);if(targetElement&&sourceElement){targetElement.replaceWith(sourceElement)}}}).catch(function(e){console.error(e)})}else{fetch("".concat(routes.cart_url,"?section_id=main-cart-items")).then(function(response){return response.text()}).then(function(responseText){var html=(new DOMParser).parseFromString(responseText,"text/html");var sourceQty=html.querySelector("cart-items");_this.innerHTML=sourceQty.innerHTML}).catch(function(e){console.error(e)})}};CartItems.prototype.getSectionsToRender=function(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]};CartItems.prototype.updateQuantity=function(line,quantity,name,variantId){var _this=this;this.enableLoading(line);var body=JSON.stringify({line:line,quantity:quantity,sections:this.getSectionsToRender().map(function(section){return section.section}),sections_url:window.location.pathname});fetch("".concat(routes.cart_change_url),__assign(__assign({},fetchConfig()),{body:body})).then(function(response){return response.text()}).then(function(state){var parsedState=JSON.parse(state);var quantityElement=document.getElementById("Quantity-".concat(line))||document.getElementById("Drawer-quantity-".concat(line));var items=document.querySelectorAll(".cart-item");if(parsedState.errors){quantityElement.value=quantityElement.getAttribute("value");_this.updateLiveRegions(line,parsedState.errors);return}_this.classList.toggle("is-empty",parsedState.item_count===0);var cartDrawerWrapper=document.querySelector("cart-drawer");var cartFooter=document.getElementById("main-cart-footer");if(cartFooter)cartFooter.classList.toggle("is-empty",parsedState.item_count===0);if(cartDrawerWrapper)cartDrawerWrapper.classList.toggle("is-empty",parsedState.item_count===0);_this.getSectionsToRender().forEach(function(section){var elementToReplace=document.getElementById(section.id).querySelector(section.selector)||document.getElementById(section.id);elementToReplace.innerHTML=_this.getSectionInnerHTML(parsedState.sections[section.section],section.selector)});var updatedValue=parsedState.items[line-1]?parsedState.items[line-1].quantity:undefined;var message="";if(items.length===parsedState.items.length&&updatedValue!==parseInt(quantityElement.value)){if(typeof updatedValue==="undefined"){message=window.cartStrings.error}else{message=window.cartStrings.quantityError.replace("[quantity]",updatedValue)}}_this.updateLiveRegions(line,message);var lineItem=document.getElementById("CartItem-".concat(line))||document.getElementById("CartDrawer-Item-".concat(line));if(lineItem&&lineItem.querySelector('[name="'.concat(name,'"]'))){cartDrawerWrapper?trapFocus(cartDrawerWrapper,lineItem.querySelector('[name="'.concat(name,'"]'))):lineItem.querySelector('[name="'.concat(name,'"]')).focus()}else if(parsedState.item_count===0&&cartDrawerWrapper){trapFocus(cartDrawerWrapper.querySelector(".drawer__inner-empty"),cartDrawerWrapper.querySelector("a"))}else if(document.querySelector(".cart-item")&&cartDrawerWrapper){trapFocus(cartDrawerWrapper,document.querySelector(".cart-item__name"))}publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:parsedState,variantId:variantId})}).catch(function(){_this.querySelectorAll(".loading__spinner").forEach(function(overlay){return overlay.classList.add("hidden")});var errors=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");errors.textContent=window.cartStrings.error}).finally(function(){_this.disableLoading(line)})};CartItems.prototype.updateLiveRegions=function(line,message){var lineItemError=document.getElementById("Line-item-error-".concat(line))||document.getElementById("CartDrawer-LineItemError-".concat(line));if(lineItemError)lineItemError.querySelector(".cart-item__error-text").innerHTML=message;this.lineItemStatusElement.setAttribute("aria-hidden",true);var cartStatus=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");cartStatus.setAttribute("aria-hidden",false);setTimeout(function(){cartStatus.setAttribute("aria-hidden",true)},1e3)};CartItems.prototype.getSectionInnerHTML=function(html,selector){return(new DOMParser).parseFromString(html,"text/html").querySelector(selector).innerHTML};CartItems.prototype.enableLoading=function(line){var mainCartItems=document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems");mainCartItems.classList.add("cart__items--disabled");var cartItemElements=this.querySelectorAll("#CartItem-".concat(line," .loading__spinner"));var cartDrawerItemElements=this.querySelectorAll("#CartDrawer-Item-".concat(line," .loading__spinner"));__spreadArray(__spreadArray([],cartItemElements,true),cartDrawerItemElements,true).forEach(function(overlay){return overlay.classList.remove("hidden")});document.activeElement.blur();this.lineItemStatusElement.setAttribute("aria-hidden",false)};CartItems.prototype.disableLoading=function(line){var mainCartItems=document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems");mainCartItems.classList.remove("cart__items--disabled");var cartItemElements=this.querySelectorAll("#CartItem-".concat(line," .loading__spinner"));var cartDrawerItemElements=this.querySelectorAll("#CartDrawer-Item-".concat(line," .loading__spinner"));cartItemElements.forEach(function(overlay){return overlay.classList.add("hidden")});cartDrawerItemElements.forEach(function(overlay){return overlay.classList.add("hidden")})};return CartItems}(HTMLElement);customElements.define("cart-items",CartItems);if(!customElements.get("cart-note")){customElements.define("cart-note",function(_super){__extends(CartNote,_super);function CartNote(){var _this=_super.call(this)||this;_this.addEventListener("change",debounce(function(event){var body=JSON.stringify({note:event.target.value});fetch("".concat(routes.cart_update_url),__assign(__assign({},fetchConfig()),{body:body}))},ON_CHANGE_DEBOUNCE_TIMER));return _this}return CartNote}(HTMLElement))}
