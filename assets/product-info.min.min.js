var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();if(!customElements.get("product-info")){customElements.define("product-info",function(_super){__extends(ProductInfo,_super);function ProductInfo(){var _this=_super.call(this)||this;_this.cartUpdateUnsubscriber=undefined;_this.variantChangeUnsubscriber=undefined;_this.input=_this.querySelector(".quantity__input");_this.currentVariant=_this.querySelector(".product-variant-id");_this.variantSelects=_this.querySelector("variant-radios");_this.submitButton=_this.querySelector('[type="submit"]');return _this}ProductInfo.prototype.connectedCallback=function(){var _this=this;if(!this.input)return;this.quantityForm=this.querySelector(".product-form__quantity");if(!this.quantityForm)return;this.setQuantityBoundries();if(!this.dataset.originalSection){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,this.fetchQuantityRules.bind(this))}this.variantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,function(event){var sectionId=_this.dataset.originalSection?_this.dataset.originalSection:_this.dataset.section;if(event.data.sectionId!==sectionId)return;_this.updateQuantityRules(event.data.sectionId,event.data.html);_this.setQuantityBoundries()})};ProductInfo.prototype.disconnectedCallback=function(){if(this.cartUpdateUnsubscriber){this.cartUpdateUnsubscriber()}if(this.variantChangeUnsubscriber){this.variantChangeUnsubscriber()}};ProductInfo.prototype.setQuantityBoundries=function(){var data={cartQuantity:this.input.dataset.cartQuantity?parseInt(this.input.dataset.cartQuantity):0,min:this.input.dataset.min?parseInt(this.input.dataset.min):1,max:this.input.dataset.max?parseInt(this.input.dataset.max):null,step:this.input.step?parseInt(this.input.step):1};var min=data.min;var max=data.max===null?data.max:data.max-data.cartQuantity;if(max!==null)min=Math.min(min,max);if(data.cartQuantity>=data.min)min=Math.min(min,data.step);this.input.min=min;this.input.max=max;this.input.value=min;publish(PUB_SUB_EVENTS.quantityUpdate,undefined)};ProductInfo.prototype.fetchQuantityRules=function(){var _this=this;if(!this.currentVariant||!this.currentVariant.value)return;this.querySelector(".quantity__rules-cart .loading__spinner").classList.remove("hidden");fetch("".concat(this.dataset.url,"?variant=").concat(this.currentVariant.value,"&section_id=").concat(this.dataset.section)).then(function(response){return response.text()}).then(function(responseText){var html=(new DOMParser).parseFromString(responseText,"text/html");_this.updateQuantityRules(_this.dataset.section,html);_this.setQuantityBoundries()}).catch(function(e){console.error(e)}).finally(function(){_this.querySelector(".quantity__rules-cart .loading__spinner").classList.add("hidden")})};ProductInfo.prototype.updateQuantityRules=function(sectionId,html){var quantityFormUpdated=html.getElementById("Quantity-Form-".concat(sectionId));var selectors=[".quantity__input",".quantity__rules",".quantity__label"];for(var _i=0,selectors_1=selectors;_i<selectors_1.length;_i++){var selector=selectors_1[_i];var current=this.quantityForm.querySelector(selector);var updated=quantityFormUpdated.querySelector(selector);if(!current||!updated)continue;if(selector===".quantity__input"){var attributes=["data-cart-quantity","data-min","data-max","step"];for(var _a=0,attributes_1=attributes;_a<attributes_1.length;_a++){var attribute=attributes_1[_a];var valueUpdated=updated.getAttribute(attribute);if(valueUpdated!==null)current.setAttribute(attribute,valueUpdated)}}else{current.innerHTML=updated.innerHTML}}};return ProductInfo}(HTMLElement))}
