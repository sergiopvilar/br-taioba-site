var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};var QuickOrderListRemoveButton=function(_super){__extends(QuickOrderListRemoveButton,_super);function QuickOrderListRemoveButton(){var _this=_super.call(this)||this;_this.addEventListener("click",function(event){event.preventDefault();var quickOrderList=_this.closest("quick-order-list");quickOrderList.updateQuantity(_this.dataset.index,0)});return _this}return QuickOrderListRemoveButton}(HTMLElement);customElements.define("quick-order-list-remove-button",QuickOrderListRemoveButton);var QuickOrderListRemoveAllButton=function(_super){__extends(QuickOrderListRemoveAllButton,_super);function QuickOrderListRemoveAllButton(){var _this=_super.call(this)||this;var allVariants=Array.from(document.querySelectorAll("[data-variant-id]"));var items={};var hasVariantsInCart=false;_this.quickOrderList=_this.closest("quick-order-list");allVariants.forEach(function(variant){var cartQty=parseInt(variant.dataset.cartQty);if(cartQty>0){hasVariantsInCart=true;items[parseInt(variant.dataset.variantId)]=0}});if(!hasVariantsInCart){_this.classList.add("hidden")}_this.actions={confirm:"confirm",remove:"remove",cancel:"cancel"};_this.addEventListener("click",function(event){event.preventDefault();if(_this.dataset.action===_this.actions.confirm){_this.toggleConfirmation(false,true)}else if(_this.dataset.action===_this.actions.remove){_this.quickOrderList.updateMultipleQty(items);_this.toggleConfirmation(true,false)}else if(_this.dataset.action===_this.actions.cancel){_this.toggleConfirmation(true,false)}});return _this}QuickOrderListRemoveAllButton.prototype.toggleConfirmation=function(showConfirmation,showInfo){this.quickOrderList.querySelector(".quick-order-list-total__confirmation").classList.toggle("hidden",showConfirmation);this.quickOrderList.querySelector(".quick-order-list-total__info").classList.toggle("hidden",showInfo)};return QuickOrderListRemoveAllButton}(HTMLElement);customElements.define("quick-order-list-remove-all-button",QuickOrderListRemoveAllButton);var QuickOrderList=function(_super){__extends(QuickOrderList,_super);function QuickOrderList(){var _this=_super.call(this)||this;_this.cartUpdateUnsubscriber=undefined;_this.cart=document.querySelector("cart-drawer");_this.actions={add:"ADD",update:"UPDATE"};_this.quickOrderListId="quick-order-list";_this.variantItemStatusElement=document.getElementById("shopping-cart-variant-item-status");var form=_this.querySelector("form");form.addEventListener("submit",_this.onSubmit.bind(_this));var debouncedOnChange=debounce(function(event){_this.onChange(event)},ON_CHANGE_DEBOUNCE_TIMER);_this.addEventListener("change",debouncedOnChange.bind(_this));return _this}QuickOrderList.prototype.onSubmit=function(event){event.preventDefault()};QuickOrderList.prototype.connectedCallback=function(){var _this=this;this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,function(event){if(event.source===_this.quickOrderListId){return}_this.onCartUpdate()});this.sectionId=this.dataset.id};QuickOrderList.prototype.disconnectedCallback=function(){if(this.cartUpdateUnsubscriber){this.cartUpdateUnsubscriber()}};QuickOrderList.prototype.onChange=function(event){var inputValue=parseInt(event.target.value);var cartQuantity=parseInt(event.target.dataset.cartQuantity);var index=event.target.dataset.index;var name=document.activeElement.getAttribute("name");var quantity=inputValue-cartQuantity;if(cartQuantity>0){this.updateQuantity(index,inputValue,name,this.actions.update)}else{this.updateQuantity(index,quantity,name,this.actions.add)}};QuickOrderList.prototype.onCartUpdate=function(){var _this=this;fetch("".concat(window.location.pathname,"?section_id=").concat(this.sectionId)).then(function(response){return response.text()}).then(function(responseText){var html=(new DOMParser).parseFromString(responseText,"text/html");var sourceQty=html.querySelector(_this.quickOrderListId);_this.innerHTML=sourceQty.innerHTML}).catch(function(e){console.error(e)})};QuickOrderList.prototype.getSectionsToRender=function(){return[{id:this.quickOrderListId,section:document.getElementById(this.quickOrderListId).dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"quick-order-list-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"quick-order-list-total",section:document.getElementById(this.quickOrderListId).dataset.id,selector:".quick-order-list__total"},{id:"CartDrawer",selector:"#CartDrawer",section:"cart-drawer"}]};QuickOrderList.prototype.renderSections=function(parsedState){var _this=this;this.getSectionsToRender().forEach(function(section){var sectionElement=document.getElementById(section.id);if(sectionElement&&sectionElement.parentElement&&sectionElement.parentElement.classList.contains("drawer")){parsedState.items.length>0?sectionElement.parentElement.classList.remove("is-empty"):sectionElement.parentElement.classList.add("is-empty");setTimeout(function(){document.querySelector("#CartDrawer-Overlay").addEventListener("click",_this.cart.close.bind(_this.cart))})}var elementToReplace=sectionElement&&sectionElement.querySelector(section.selector)?sectionElement.querySelector(section.selector):sectionElement;if(elementToReplace){elementToReplace.innerHTML=_this.getSectionInnerHTML(parsedState.sections[section.section],section.selector)}})};QuickOrderList.prototype.updateMultipleQty=function(items){var _this=this;this.querySelector(".variant-remove-total .loading__spinner").classList.remove("hidden");var body=JSON.stringify({updates:items,sections:this.getSectionsToRender().map(function(section){return section.section}),sections_url:window.location.pathname});this.updateMessage();this.setErrorMessage();fetch("".concat(routes.cart_update_url),__assign(__assign({},fetchConfig()),{body:body})).then(function(response){return response.text()}).then(function(state){var parsedState=JSON.parse(state);_this.renderSections(parsedState)}).catch(function(){_this.setErrorMessage(window.cartStrings.error)}).finally(function(){_this.querySelector(".variant-remove-total .loading__spinner").classList.add("hidden")})};QuickOrderList.prototype.updateQuantity=function(id,quantity,name,action){var _this=this;this.toggleLoading(id,true);var routeUrl=routes.cart_change_url;var body=JSON.stringify({quantity:quantity,id:id,sections:this.getSectionsToRender().map(function(section){return section.section}),sections_url:window.location.pathname});var fetchConfigType;if(action===this.actions.add){fetchConfigType="javascript";routeUrl=routes.cart_add_url;body=JSON.stringify({items:[{quantity:parseInt(quantity),id:parseInt(id)}],sections:this.getSectionsToRender().map(function(section){return section.section}),sections_url:window.location.pathname})}this.updateMessage();this.setErrorMessage();fetch("".concat(routeUrl),__assign(__assign({},fetchConfig(fetchConfigType)),{body:body})).then(function(response){return response.text()}).then(function(state){var parsedState=JSON.parse(state);var quantityElement=document.getElementById("Quantity-".concat(id));var items=document.querySelectorAll(".variant-item");if(parsedState.description||parsedState.errors){var variantItem_1=document.querySelector('[id^="Variant-'.concat(id,'"] .variant-item__totals.small-hide .loading__spinner'));variantItem_1.classList.add("loading__spinner--error");_this.resetQuantityInput(id,quantityElement);if(parsedState.errors){_this.updateLiveRegions(id,parsedState.errors)}else{_this.updateLiveRegions(id,parsedState.description)}return}_this.classList.toggle("is-empty",parsedState.item_count===0);_this.renderSections(parsedState);var hasError=false;var currentItem=parsedState.items.find(function(item){return item.variant_id===parseInt(id)});var updatedValue=currentItem?currentItem.quantity:undefined;if(updatedValue&&updatedValue!==quantity){_this.updateError(updatedValue,id);hasError=true}var variantItem=document.getElementById("Variant-".concat(id));if(variantItem&&variantItem.querySelector('[name="'.concat(name,'"]'))){variantItem.querySelector('[name="'.concat(name,'"]')).focus()}publish(PUB_SUB_EVENTS.cartUpdate,{source:_this.quickOrderListId,cartData:parsedState});if(hasError){_this.updateMessage()}else if(action===_this.actions.add){_this.updateMessage(parseInt(quantity))}else if(action===_this.actions.update){_this.updateMessage(parseInt(quantity-quantityElement.dataset.cartQuantity))}else{_this.updateMessage(-parseInt(quantityElement.dataset.cartQuantity))}}).catch(function(error){_this.querySelectorAll(".loading__spinner").forEach(function(overlay){return overlay.classList.add("hidden")});_this.resetQuantityInput(id);console.error(error);_this.setErrorMessage(window.cartStrings.error)}).finally(function(){_this.toggleLoading(id)})};QuickOrderList.prototype.resetQuantityInput=function(id,quantityElement){var input=quantityElement!==null&&quantityElement!==void 0?quantityElement:document.getElementById("Quantity-".concat(id));input.value=input.getAttribute("value")};QuickOrderList.prototype.setErrorMessage=function(message){var _this=this;var _a;if(message===void 0){message=null}this.errorMessageTemplate=(_a=this.errorMessageTemplate)!==null&&_a!==void 0?_a:document.getElementById("QuickOrderListErrorTemplate-".concat(this.sectionId)).cloneNode(true);var errorElements=document.querySelectorAll(".quick-order-list-error");errorElements.forEach(function(errorElement){errorElement.innerHTML="";if(!message)return;var updatedMessageElement=_this.errorMessageTemplate.cloneNode(true);updatedMessageElement.content.querySelector(".quick-order-list-error-message").innerText=message;errorElement.appendChild(updatedMessageElement.content)})};QuickOrderList.prototype.updateMessage=function(quantity){if(quantity===void 0){quantity=null}var messages=this.querySelectorAll(".quick-order-list__message-text");var icons=this.querySelectorAll(".quick-order-list__message-icon");if(quantity===null||isNaN(quantity)){messages.forEach(function(message){return message.innerHTML=""});icons.forEach(function(icon){return icon.classList.add("hidden")});return}var isQuantityNegative=quantity<0;var absQuantity=Math.abs(quantity);var textTemplate=isQuantityNegative?absQuantity===1?window.quickOrderListStrings.itemRemoved:window.quickOrderListStrings.itemsRemoved:quantity===1?window.quickOrderListStrings.itemAdded:window.quickOrderListStrings.itemsAdded;messages.forEach(function(msg){return msg.innerHTML=textTemplate.replace("[quantity]",absQuantity)});if(!isQuantityNegative){icons.forEach(function(i){return i.classList.remove("hidden")})}};QuickOrderList.prototype.updateError=function(updatedValue,id){var message="";if(typeof updatedValue==="undefined"){message=window.cartStrings.error}else{message=window.cartStrings.quantityError.replace("[quantity]",updatedValue)}this.updateLiveRegions(id,message)};QuickOrderList.prototype.updateLiveRegions=function(id,message){var variantItemErrorDesktop=document.getElementById("Quick-order-list-item-error-desktop-".concat(id));var variantItemErrorMobile=document.getElementById("Quick-order-list-item-error-mobile-".concat(id));if(variantItemErrorDesktop){variantItemErrorDesktop.querySelector(".variant-item__error-text").innerHTML=message;variantItemErrorDesktop.closest("tr").classList.remove("hidden")}if(variantItemErrorMobile)variantItemErrorMobile.querySelector(".variant-item__error-text").innerHTML=message;this.variantItemStatusElement.setAttribute("aria-hidden",true);var cartStatus=document.getElementById("quick-order-list-live-region-text");cartStatus.setAttribute("aria-hidden",false);setTimeout(function(){cartStatus.setAttribute("aria-hidden",true)},1e3)};QuickOrderList.prototype.getSectionInnerHTML=function(html,selector){return(new DOMParser).parseFromString(html,"text/html").querySelector(selector).innerHTML};QuickOrderList.prototype.toggleLoading=function(id,enable){var quickOrderList=document.getElementById(this.quickOrderListId);var quickOrderListItems=this.querySelectorAll("#Variant-".concat(id," .loading__spinner"));if(enable){quickOrderList.classList.add("quick-order-list__container--disabled");__spreadArray([],quickOrderListItems,true).forEach(function(overlay){return overlay.classList.remove("hidden")});document.activeElement.blur();this.variantItemStatusElement.setAttribute("aria-hidden",false)}else{quickOrderList.classList.remove("quick-order-list__container--disabled");quickOrderListItems.forEach(function(overlay){return overlay.classList.add("hidden")})}};return QuickOrderList}(HTMLElement);customElements.define("quick-order-list",QuickOrderList);
