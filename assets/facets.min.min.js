var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};var FacetFiltersForm=function(_super){__extends(FacetFiltersForm,_super);function FacetFiltersForm(){var _this=_super.call(this)||this;_this.onActiveFilterClick=_this.onActiveFilterClick.bind(_this);_this.debouncedOnSubmit=debounce(function(event){_this.onSubmitHandler(event)},500);var facetForm=_this.querySelector("form");facetForm.addEventListener("input",_this.debouncedOnSubmit.bind(_this));var facetWrapper=_this.querySelector("#FacetsWrapperDesktop");if(facetWrapper)facetWrapper.addEventListener("keyup",onKeyUpEscape);return _this}FacetFiltersForm.setListeners=function(){var onHistoryChange=function(event){var searchParams=event.state?event.state.searchParams:FacetFiltersForm.searchParamsInitial;if(searchParams===FacetFiltersForm.searchParamsPrev)return;FacetFiltersForm.renderPage(searchParams,null,false)};window.addEventListener("popstate",onHistoryChange)};FacetFiltersForm.toggleActiveFacets=function(disable){if(disable===void 0){disable=true}document.querySelectorAll(".js-facet-remove").forEach(function(element){element.classList.toggle("disabled",disable)})};FacetFiltersForm.renderPage=function(searchParams,event,updateURLHash){if(updateURLHash===void 0){updateURLHash=true}FacetFiltersForm.searchParamsPrev=searchParams;var sections=FacetFiltersForm.getSections();var countContainer=document.getElementById("ProductCount");var countContainerDesktop=document.getElementById("ProductCountDesktop");var loadingSpinners=document.querySelectorAll(".facets-container .loading__spinner, facet-filters-form .loading__spinner");loadingSpinners.forEach(function(spinner){return spinner.classList.remove("hidden")});document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading");if(countContainer){countContainer.classList.add("loading")}if(countContainerDesktop){countContainerDesktop.classList.add("loading")}sections.forEach(function(section){var url="".concat(window.location.pathname,"?section_id=").concat(section.section,"&").concat(searchParams);var filterDataUrl=function(element){return element.url===url};FacetFiltersForm.filterData.some(filterDataUrl)?FacetFiltersForm.renderSectionFromCache(filterDataUrl,event):FacetFiltersForm.renderSectionFromFetch(url,event)});if(updateURLHash)FacetFiltersForm.updateURLHash(searchParams)};FacetFiltersForm.renderSectionFromFetch=function(url,event){fetch(url).then(function(response){return response.text()}).then(function(responseText){var html=responseText;FacetFiltersForm.filterData=__spreadArray(__spreadArray([],FacetFiltersForm.filterData,true),[{html:html,url:url}],false);FacetFiltersForm.renderFilters(html,event);FacetFiltersForm.renderProductGridContainer(html);FacetFiltersForm.renderProductCount(html);if(typeof initializeScrollAnimationTrigger==="function")initializeScrollAnimationTrigger(html.innerHTML)})};FacetFiltersForm.renderSectionFromCache=function(filterDataUrl,event){var html=FacetFiltersForm.filterData.find(filterDataUrl).html;FacetFiltersForm.renderFilters(html,event);FacetFiltersForm.renderProductGridContainer(html);FacetFiltersForm.renderProductCount(html);if(typeof initializeScrollAnimationTrigger==="function")initializeScrollAnimationTrigger(html.innerHTML)};FacetFiltersForm.renderProductGridContainer=function(html){document.getElementById("ProductGridContainer").innerHTML=(new DOMParser).parseFromString(html,"text/html").getElementById("ProductGridContainer").innerHTML;document.getElementById("ProductGridContainer").querySelectorAll(".scroll-trigger").forEach(function(element){element.classList.add("scroll-trigger--cancel")})};FacetFiltersForm.renderProductCount=function(html){var count=(new DOMParser).parseFromString(html,"text/html").getElementById("ProductCount").innerHTML;var container=document.getElementById("ProductCount");var containerDesktop=document.getElementById("ProductCountDesktop");container.innerHTML=count;container.classList.remove("loading");if(containerDesktop){containerDesktop.innerHTML=count;containerDesktop.classList.remove("loading")}var loadingSpinners=document.querySelectorAll(".facets-container .loading__spinner, facet-filters-form .loading__spinner");loadingSpinners.forEach(function(spinner){return spinner.classList.add("hidden")})};FacetFiltersForm.renderFilters=function(html,event){var parsedHTML=(new DOMParser).parseFromString(html,"text/html");var facetDetailsElements=parsedHTML.querySelectorAll("#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter");var matchesIndex=function(element){var jsFilter=event?event.target.closest(".js-filter"):undefined;return jsFilter?element.dataset.index===jsFilter.dataset.index:false};var facetsToRender=Array.from(facetDetailsElements).filter(function(element){return!matchesIndex(element)});var countsToRender=Array.from(facetDetailsElements).find(matchesIndex);facetsToRender.forEach(function(element){document.querySelector('.js-filter[data-index="'.concat(element.dataset.index,'"]')).innerHTML=element.innerHTML});FacetFiltersForm.renderActiveFacets(parsedHTML);FacetFiltersForm.renderAdditionalElements(parsedHTML);if(countsToRender){var closestJSFilterID=event.target.closest(".js-filter").id;if(closestJSFilterID){FacetFiltersForm.renderCounts(countsToRender,event.target.closest(".js-filter"));FacetFiltersForm.renderMobileCounts(countsToRender,document.getElementById(closestJSFilterID));var newElementSelector=document.getElementById(closestJSFilterID).classList.contains("mobile-facets__details")?"#".concat(closestJSFilterID," .mobile-facets__close-button"):"#".concat(closestJSFilterID," .facets__summary");var newElementToActivate=document.querySelector(newElementSelector);if(newElementToActivate)newElementToActivate.focus()}}};FacetFiltersForm.renderActiveFacets=function(html){var activeFacetElementSelectors=[".active-facets-mobile",".active-facets-desktop"];activeFacetElementSelectors.forEach(function(selector){var activeFacetsElement=html.querySelector(selector);if(!activeFacetsElement)return;document.querySelector(selector).innerHTML=activeFacetsElement.innerHTML});FacetFiltersForm.toggleActiveFacets(false)};FacetFiltersForm.renderAdditionalElements=function(html){var mobileElementSelectors=[".mobile-facets__open",".mobile-facets__count",".sorting"];mobileElementSelectors.forEach(function(selector){if(!html.querySelector(selector))return;document.querySelector(selector).innerHTML=html.querySelector(selector).innerHTML});document.getElementById("FacetFiltersFormMobile").closest("menu-drawer").bindEvents()};FacetFiltersForm.renderCounts=function(source,target){var targetSummary=target.querySelector(".facets__summary");var sourceSummary=source.querySelector(".facets__summary");if(sourceSummary&&targetSummary){targetSummary.outerHTML=sourceSummary.outerHTML}var targetHeaderElement=target.querySelector(".facets__header");var sourceHeaderElement=source.querySelector(".facets__header");if(sourceHeaderElement&&targetHeaderElement){targetHeaderElement.outerHTML=sourceHeaderElement.outerHTML}var targetWrapElement=target.querySelector(".facets-wrap");var sourceWrapElement=source.querySelector(".facets-wrap");if(sourceWrapElement&&targetWrapElement){var isShowingMore=Boolean(target.querySelector("show-more-button .label-show-more.hidden"));if(isShowingMore){sourceWrapElement.querySelectorAll(".facets__item.hidden").forEach(function(hiddenItem){return hiddenItem.classList.replace("hidden","show-more-item")})}targetWrapElement.outerHTML=sourceWrapElement.outerHTML}};FacetFiltersForm.renderMobileCounts=function(source,target){var targetFacetsList=target.querySelector(".mobile-facets__list");var sourceFacetsList=source.querySelector(".mobile-facets__list");if(sourceFacetsList&&targetFacetsList){targetFacetsList.outerHTML=sourceFacetsList.outerHTML}};FacetFiltersForm.updateURLHash=function(searchParams){history.pushState({searchParams:searchParams},"","".concat(window.location.pathname).concat(searchParams&&"?".concat(searchParams)))};FacetFiltersForm.getSections=function(){return[{section:document.getElementById("product-grid").dataset.id}]};FacetFiltersForm.prototype.createSearchParams=function(form){var formData=new FormData(form);return new URLSearchParams(formData).toString()};FacetFiltersForm.prototype.onSubmitForm=function(searchParams,event){FacetFiltersForm.renderPage(searchParams,event)};FacetFiltersForm.prototype.onSubmitHandler=function(event){var _this=this;event.preventDefault();var sortFilterForms=document.querySelectorAll("facet-filters-form form");if(event.srcElement.className=="mobile-facets__checkbox"){var searchParams=this.createSearchParams(event.target.closest("form"));this.onSubmitForm(searchParams,event)}else{var forms_1=[];var isMobile_1=event.target.closest("form").id==="FacetFiltersFormMobile";sortFilterForms.forEach(function(form){if(!isMobile_1){if(form.id==="FacetSortForm"||form.id==="FacetFiltersForm"||form.id==="FacetSortDrawerForm"){var noJsElements=document.querySelectorAll(".no-js-list");noJsElements.forEach(function(el){return el.remove()});forms_1.push(_this.createSearchParams(form))}}else if(form.id==="FacetFiltersFormMobile"){forms_1.push(_this.createSearchParams(form))}});this.onSubmitForm(forms_1.join("&"),event)}};FacetFiltersForm.prototype.onActiveFilterClick=function(event){event.preventDefault();FacetFiltersForm.toggleActiveFacets();var url=event.currentTarget.href.indexOf("?")==-1?"":event.currentTarget.href.slice(event.currentTarget.href.indexOf("?")+1);FacetFiltersForm.renderPage(url)};return FacetFiltersForm}(HTMLElement);FacetFiltersForm.filterData=[];FacetFiltersForm.searchParamsInitial=window.location.search.slice(1);FacetFiltersForm.searchParamsPrev=window.location.search.slice(1);customElements.define("facet-filters-form",FacetFiltersForm);FacetFiltersForm.setListeners();var PriceRange=function(_super){__extends(PriceRange,_super);function PriceRange(){var _this=_super.call(this)||this;_this.querySelectorAll("input").forEach(function(element){return element.addEventListener("change",_this.onRangeChange.bind(_this))});_this.setMinAndMaxValues();return _this}PriceRange.prototype.onRangeChange=function(event){this.adjustToValidValues(event.currentTarget);this.setMinAndMaxValues()};PriceRange.prototype.setMinAndMaxValues=function(){var inputs=this.querySelectorAll("input");var minInput=inputs[0];var maxInput=inputs[1];if(maxInput.value)minInput.setAttribute("max",maxInput.value);if(minInput.value)maxInput.setAttribute("min",minInput.value);if(minInput.value==="")maxInput.setAttribute("min",0);if(maxInput.value==="")minInput.setAttribute("max",maxInput.getAttribute("max"))};PriceRange.prototype.adjustToValidValues=function(input){var value=Number(input.value);var min=Number(input.getAttribute("min"));var max=Number(input.getAttribute("max"));if(value<min)input.value=min;if(value>max)input.value=max};return PriceRange}(HTMLElement);customElements.define("price-range",PriceRange);var FacetRemove=function(_super){__extends(FacetRemove,_super);function FacetRemove(){var _this=_super.call(this)||this;var facetLink=_this.querySelector("a");facetLink.setAttribute("role","button");facetLink.addEventListener("click",_this.closeFilter.bind(_this));facetLink.addEventListener("keyup",function(event){event.preventDefault();if(event.code.toUpperCase()==="SPACE")_this.closeFilter(event)});return _this}FacetRemove.prototype.closeFilter=function(event){event.preventDefault();var form=this.closest("facet-filters-form")||document.querySelector("facet-filters-form");form.onActiveFilterClick(event)};return FacetRemove}(HTMLElement);customElements.define("facet-remove",FacetRemove);
