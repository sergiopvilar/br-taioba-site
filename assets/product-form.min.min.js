var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();if(!customElements.get("product-form")){customElements.define("product-form",function(_super){__extends(ProductForm,_super);function ProductForm(){var _this=_super.call(this)||this;_this.form=_this.querySelector("form");_this.form.querySelector("[name=id]").disabled=false;_this.form.addEventListener("submit",_this.onSubmitHandler.bind(_this));_this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer");_this.submitButton=_this.querySelector('[type="submit"]');if(document.querySelector("cart-drawer"))_this.submitButton.setAttribute("aria-haspopup","dialog");_this.hideErrors=_this.dataset.hideErrors==="true";return _this}ProductForm.prototype.onSubmitHandler=function(evt){var _this=this;evt.preventDefault();if(this.submitButton.getAttribute("aria-disabled")==="true")return;this.handleErrorMessage();this.submitButton.setAttribute("aria-disabled",true);this.submitButton.classList.add("loading");this.querySelector(".loading__spinner").classList.remove("hidden");var config=fetchConfig("javascript");config.headers["X-Requested-With"]="XMLHttpRequest";delete config.headers["Content-Type"];var formData=new FormData(this.form);if(this.cart){formData.append("sections",this.cart.getSectionsToRender().map(function(section){return section.id}));formData.append("sections_url",window.location.pathname);this.cart.setActiveElement(document.activeElement)}config.body=formData;fetch("".concat(routes.cart_add_url),config).then(function(response){return response.json()}).then(function(response){if(response.status){publish(PUB_SUB_EVENTS.cartError,{source:"product-form",productVariantId:formData.get("id"),errors:response.errors||response.description,message:response.message});_this.handleErrorMessage(response.description);var soldOutMessage=_this.submitButton.querySelector(".sold-out-message");if(!soldOutMessage)return;_this.submitButton.setAttribute("aria-disabled",true);_this.submitButton.querySelector("span").classList.add("hidden");soldOutMessage.classList.remove("hidden");_this.error=true;return}else if(!_this.cart){window.location=window.routes.cart_url;return}if(!_this.error)publish(PUB_SUB_EVENTS.cartUpdate,{source:"product-form",productVariantId:formData.get("id"),cartData:response});_this.error=false;var quickAddModal=_this.closest("quick-add-modal");if(quickAddModal){document.body.addEventListener("modalClosed",function(){setTimeout(function(){_this.cart.renderContents(response)})},{once:true});quickAddModal.hide(true)}else{_this.cart.renderContents(response)}}).catch(function(e){console.error(e)}).finally(function(){_this.submitButton.classList.remove("loading");if(_this.cart&&_this.cart.classList.contains("is-empty"))_this.cart.classList.remove("is-empty");if(!_this.error)_this.submitButton.removeAttribute("aria-disabled");_this.querySelector(".loading__spinner").classList.add("hidden")})};ProductForm.prototype.handleErrorMessage=function(errorMessage){if(errorMessage===void 0){errorMessage=false}if(this.hideErrors)return;this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper");if(!this.errorMessageWrapper)return;this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message");this.errorMessageWrapper.toggleAttribute("hidden",!errorMessage);if(errorMessage){this.errorMessage.textContent=errorMessage}};return ProductForm}(HTMLElement))}
