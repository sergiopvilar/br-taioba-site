var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};if(!customElements.get("recipient-form")){customElements.define("recipient-form",function(_super){__extends(RecipientForm,_super);function RecipientForm(){var _a,_b,_c;var _this=_super.call(this)||this;_this.cartUpdateUnsubscriber=undefined;_this.variantChangeUnsubscriber=undefined;_this.cartErrorUnsubscriber=undefined;_this.recipientFieldsLiveRegion=_this.querySelector("#Recipient-fields-live-region-".concat(_this.dataset.sectionId));_this.checkboxInput=_this.querySelector("#Recipient-checkbox-".concat(_this.dataset.sectionId));_this.checkboxInput.disabled=false;_this.hiddenControlField=_this.querySelector("#Recipient-control-".concat(_this.dataset.sectionId));_this.hiddenControlField.disabled=true;_this.emailInput=_this.querySelector("#Recipient-email-".concat(_this.dataset.sectionId));_this.nameInput=_this.querySelector("#Recipient-name-".concat(_this.dataset.sectionId));_this.messageInput=_this.querySelector("#Recipient-message-".concat(_this.dataset.sectionId));_this.sendonInput=_this.querySelector("#Recipient-send-on-".concat(_this.dataset.sectionId));_this.offsetProperty=_this.querySelector("#Recipient-timezone-offset-".concat(_this.dataset.sectionId));if(_this.offsetProperty)_this.offsetProperty.value=(new Date).getTimezoneOffset().toString();_this.errorMessageWrapper=_this.querySelector(".product-form__recipient-error-message-wrapper");_this.errorMessageList=(_a=_this.errorMessageWrapper)===null||_a===void 0?void 0:_a.querySelector("ul");_this.errorMessage=(_b=_this.errorMessageWrapper)===null||_b===void 0?void 0:_b.querySelector(".error-message");_this.defaultErrorHeader=(_c=_this.errorMessage)===null||_c===void 0?void 0:_c.innerText;_this.currentProductVariantId=_this.dataset.productVariantId;_this.addEventListener("change",_this.onChange.bind(_this));_this.onChange();return _this}RecipientForm.prototype.connectedCallback=function(){var _this=this;this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,function(event){if(event.source==="product-form"&&event.productVariantId.toString()===_this.currentProductVariantId){_this.resetRecipientForm()}});this.variantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,function(event){if(event.data.sectionId===_this.dataset.sectionId){_this.currentProductVariantId=event.data.variant.id.toString()}});this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartError,function(event){if(event.source==="product-form"&&event.productVariantId.toString()===_this.currentProductVariantId){_this.displayErrorMessage(event.message,event.errors)}})};RecipientForm.prototype.disconnectedCallback=function(){if(this.cartUpdateUnsubscriber){this.cartUpdateUnsubscriber()}if(this.variantChangeUnsubscriber){this.variantChangeUnsubscriber()}if(this.cartErrorUnsubscriber){this.cartErrorUnsubscriber()}};RecipientForm.prototype.onChange=function(){if(this.checkboxInput.checked){this.enableInputFields();this.recipientFieldsLiveRegion.innerText=window.accessibilityStrings.recipientFormExpanded}else{this.clearInputFields();this.disableInputFields();this.clearErrorMessage();this.recipientFieldsLiveRegion.innerText=window.accessibilityStrings.recipientFormCollapsed}};RecipientForm.prototype.inputFields=function(){return[this.emailInput,this.nameInput,this.messageInput,this.sendonInput]};RecipientForm.prototype.disableableFields=function(){return __spreadArray(__spreadArray([],this.inputFields(),true),[this.offsetProperty],false)};RecipientForm.prototype.clearInputFields=function(){this.inputFields().forEach(function(field){return field.value=""})};RecipientForm.prototype.enableInputFields=function(){this.disableableFields().forEach(function(field){return field.disabled=false})};RecipientForm.prototype.disableInputFields=function(){this.disableableFields().forEach(function(field){return field.disabled=true})};RecipientForm.prototype.displayErrorMessage=function(title,body){var _this=this;this.clearErrorMessage();this.errorMessageWrapper.hidden=false;if(typeof body==="object"){this.errorMessage.innerText=this.defaultErrorHeader;return Object.entries(body).forEach(function(_a){var key=_a[0],value=_a[1];var errorMessageId="RecipientForm-".concat(key,"-error-").concat(_this.dataset.sectionId);var fieldSelector="#Recipient-".concat(key,"-").concat(_this.dataset.sectionId);var message="".concat(value.join(", "));var errorMessageElement=_this.querySelector("#".concat(errorMessageId));var errorTextElement=errorMessageElement===null||errorMessageElement===void 0?void 0:errorMessageElement.querySelector(".error-message");if(!errorTextElement)return;if(_this.errorMessageList){_this.errorMessageList.appendChild(_this.createErrorListItem(fieldSelector,message))}errorTextElement.innerText="".concat(message,".");errorMessageElement.classList.remove("hidden");var inputElement=_this["".concat(key,"Input")];if(!inputElement)return;inputElement.setAttribute("aria-invalid",true);inputElement.setAttribute("aria-describedby",errorMessageId)})}this.errorMessage.innerText=body};RecipientForm.prototype.createErrorListItem=function(target,message){var li=document.createElement("li");var a=document.createElement("a");a.setAttribute("href",target);a.innerText=message;li.appendChild(a);li.className="error-message";return li};RecipientForm.prototype.clearErrorMessage=function(){this.errorMessageWrapper.hidden=true;if(this.errorMessageList)this.errorMessageList.innerHTML="";this.querySelectorAll(".recipient-fields .form__message").forEach(function(field){field.classList.add("hidden");var textField=field.querySelector(".error-message");if(textField)textField.innerText=""});[this.emailInput,this.messageInput,this.nameInput,this.sendonInput].forEach(function(inputElement){inputElement.setAttribute("aria-invalid",false);inputElement.removeAttribute("aria-describedby")})};RecipientForm.prototype.resetRecipientForm=function(){if(this.checkboxInput.checked){this.checkboxInput.checked=false;this.clearInputFields();this.clearErrorMessage()}};return RecipientForm}(HTMLElement))}
